$.browser={};
$.browser.mozilla = /firefox/.test(navigator.userAgent.toLowerCase());
$.browser.webkit = /webkit/.test(navigator.userAgent.toLowerCase());
$.browser.opera = /opera/.test(navigator.userAgent.toLowerCase());
$.browser.msie = /msie/.test(navigator.userAgent.toLowerCase());
var defaultBackgroundUploadService = "uploadBackground.jsp";
var editorSettings={type:0,getURL:function(){if(this.settingsID&&this.type==2){return this.url+"&settingsID="+encodeURI(editorSettings.settingsID+".tmp")}else{return this.url}},willLoad:function(){return(editorSettings.type==1||(editorSettings.type==2&&editorSettings.settingsID))}};$.editorTypes={"user.design":2,"user.position":1};if(window.dialogArguments){$.extend(editorSettings,window.dialogArguments)}if($.editorTypes[editorSettings.type]){editorSettings.type=$.editorTypes[editorSettings.type]}$(function(){if(document.URL.match(/^http:\/\//i)&&!editorSettings.backgroundUploadService){editorSettings.backgroundUploadService=defaultBackgroundUploadService}var a="12";function M(aJ){var j=Q().getLastSettings(aJ);return j}var ak=0;var aD=100;var an="images/blank.png";String.prototype.format=String.prototype.f=function(){var aJ=this,j=arguments;var aK=/\{([0-9]+)\}/g;return aJ.replace(aK,function(aM,aL){return j[parseInt(aL)]})};function Z(j,aJ){j=j.replace(/\n\s*\n/g,"\n");j=j.replace(/^[\s\n]*/,"");j=j.replace(/[\s\n]*$/,"");ak=0;aJ(j)}function Y(aJ,aP){var aM=0;function aN(){var aS=aM;for(;aM<aJ.length&&aM<aS+aD;aM++){aO=aM;if(-1==aJ.substr(aM).indexOf("<")){aL+=aJ.substr(aM);Z(aL,aP);return}while(aO<aJ.length&&"<"!=aJ.charAt(aO)){aO++}if(aM!=aO){aQ=aJ.substr(aM,aO-aM);if(!aQ.match(/^\s+$/)){if("\n"==aL.charAt(aL.length-1)){aL+=T()}else{if("\n"==aQ.charAt(0)){aL+="\n"+T();aQ=aQ.replace(/^\s+/,"")}}aQ=aQ.replace(/\s+/g," ");aL+=aQ}if(aQ.match(/\n/)){aL+="\n"+T()}}j=aO;while(aO<aJ.length&&">"!=aJ.charAt(aO)){aO++}aR=aJ.substr(j,aO-j);aM=aO;if("!--"==aR.substr(1,3)){if(!aR.match(/--$/)){while("-->"!=aJ.substr(aO,3)){aO++}aO+=2;aR=aJ.substr(j,aO-j);aM=aO}if("\n"!=aL.charAt(aL.length-1)){aL+="\n"}aL+=T();aL+=aR+">\n"}else{if("!"==aR[1]){aL=x(aR+">",aL)}else{if("?"==aR[1]){aL+=aR+">\n"}else{if(t=aR.match(/^<(script|style)/i)){t[1]=t[1].toLowerCase();aR=J(aR);aL=x(aR,aL);var aT=aR.match(/^<style/i);aK=String(aJ.substr(aM+1)).toLowerCase().indexOf("</"+t[1]);if(aK){aQ=aJ.substr(aM+1,aK);if(aT){aQ=aQ.replace(/^([\s]*)(.*)$/gm,function(aU,aW,aV){return("\t"+(aV||""))})}aM+=aK;aL+=aQ}}else{aR=J(aR);aL=x(aR,aL)}}}}}if(aM<aJ.length){setTimeout(aN,0)}else{Z(aL,aP)}}var aO=0,j=null,aK=null,aR="",aL="",aQ="";aN()}function T(){var aK="";for(var aJ=0;aJ<ak;aJ++){aK+="\t"}return aK}function J(aJ){var aM="";aJ=aJ.replace(/\n/g," ");aJ=aJ.replace(/[\s]{2,}/g," ");aJ=aJ.replace(/^\s+|\s+$/g," ");var aL="";if(aJ.match(/\/$/)){aL="/";aJ=aJ.replace(/\/+$/,"")}var j,aK=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/;while(j=aK.exec(aJ)){if(j[2]){aM+=j[1].toLowerCase()+"="+j[2]}else{if(j[1]){aM+=j[1].toLowerCase()}}aM+=" ";aJ=aJ.substr(j[0].length)}return aM.replace(/\s*$/,"")+aL+">"}var F=["area","body","head","hr","i?frame","link","meta","noscript","style","table","tbody","thead","tfoot"];var ae=["li","dt","dt","h[1-6]","option","script"];var i=new RegExp("^<(/?"+F.join("|/?")+"|"+ae.join("|")+")[ >]");lineAfter=new RegExp("^<(br|/?"+F.join("|/?")+"|/"+ae.join("|/")+")[ >]");var ac=["blockquote","div","dl","fieldset","form","frameset","map","ol","p","pre","select","td","th","tr","ul","object"];ac=new RegExp("^</?("+ac.join("|")+")[ >]");function x(j,aK){var aJ=j.match(ac);if(j.match(i)||aJ){aK=aK.replace(/\s*$/,"");aK+="\n"}if(aJ&&"/"==j.charAt(1)){ak--}if("\n"==aK.charAt(aK.length-1)){aK+=T()}if(aJ&&"/"!=j.charAt(1)){ak++}aK+=j;if(j.match(lineAfter)||j.match(ac)){aK=aK.replace(/ *$/,"");aK+="\n"}return aK}var A="html 文件 (*.htm;*.html)|*.htm;*.html|所有文件 (*.*)|*.*";function ab(){return Q();if(!$.jp2){$.jp2=navigator.userAgent.indexOf("MSIE")>-1?document.getElementById("ojatoolsPrinter"):document.getElementById("ejatoolsPrinter")}return $.jp2}function Q(){if(!$.jp){var j=$("#jp-ax");var aJ=j.contents()[0];$.jp=navigator.userAgent.indexOf("MSIE")>-1?aJ.getElementById("ojatoolsPrinter"):aJ.getElementById("ejatoolsPrinter")}return $.jp}function E(j){Q().copy(j)}function v(){return Q().copied()}function aF(aK){var aJ=Q();var j=aJ.chooseFile(A,"htm",true);if(j){aJ.writeString(j,"utf-8",aK)}}function at(aJ){var j=$("#jp-error-dialog").dialog({dialogClass:"jp-error-dialog",width2:200,buttons:{"知道了":function(){$(this).dialog("close")}}}).find(".jp-error-text").html(aJ)}function s(){var aM=Q();var aL=aM.chooseFile(A,"htm",false);if(aL){var aK=aM.readHTML(aL,"utf-8");var aJ=$('<iframe class="jp-html-loader"><iframe>');$(document.body).append(aJ);var aN=aJ.contents()[0];aN.open();aN.writeln(aK);aN.close();var j=$(".jp-page",aN);if(!j.length){at("你的文档有问题啊,没找到 <strong>id</strong> 为 <strong>page1</strong> 对象啊!")}else{b.sourceCodeViewer.util.decode(j)}aJ.remove()}}function ai(j,aK){var aJ=$('<style type="text/css"></style>').appendTo($("head",aK)).attr({type:"text/css"})[0];if(aJ.styleSheet!==undefined&&aJ.styleSheet.cssText!==undefined){aJ.styleSheet.cssText=j}else{aJ.appendChild(document.createTextNode(j))}return aJ}function I(aK,aJ){var aM=aK.contents()[0];var j=$("#page1",aM);if(!j.length){at("你的文档有问题啊,没找到 <strong>id</strong> 为 <strong>page1</strong> 对象啊!")}else{var aL=M(editorSettings.settingsID);ap.applySettings(aL);ai(ap.styles,aM);b.sourceCodeViewer.util.decode(j,aJ)}aK.remove()}function D(aJ){var j=$('<iframe class="jp-html-loader" style="position:absolute;top:0px;left:0;width:0;height:0;"><iframe>')[0];if($.browser.msie){j.onreadystatechange=function(){if(j.readyState=="complete"){I($(j),aJ)}};$(document.body).append($(j));j.src=aJ}else{$(document.body).append($(j));j.src=aJ;j.onload=function(){I($(j),aJ)}}}var O=null;function f(){O&&O.data("dropdown-trigger").dropdown("hide");al&&$(al).spectrum("hide")}function au(aL){aL.extend(aL.fn,{dropdown:function(aN,aM){switch(aN){case"hide":aK();return aL(this);case"attach":return aL(this).attr("data-dropdown",aM);case"detach":aK();return aL(this).removeAttr("data-dropdown");case"disable":return aL(this).addClass("dropdown-disabled");case"enable":aK();return aL(this).removeClass("dropdown-disabled")}}});function aJ(aO){var aM=aL(this),aP=aL(aM.attr("data-dropdown")),aN=aM.hasClass("dropdown-open");if(aM!==aO.target&&aL(aO.target).hasClass("dropdown-ignore")){return}aO.preventDefault();aO.stopPropagation();aK();if(aN||aM.hasClass("dropdown-disabled")){return}aM.addClass("dropdown-open");aP.data("dropdown-trigger",aM).show();j();aP.trigger("show",{dropdown:aP,trigger:aM});O=aP}function aK(aM){var aN=aM?aL(aM.target).parents().addBack():null;if(aN&&aN.is(".dropdown")){if(aN.is(".dropdown-menu")){if(!aN.is("A")){return}}else{return}}aL(document).find(".dropdown:visible").each(function(){var aO=aL(this);aO.hide().removeData("dropdown-trigger").trigger("hide",{dropdown:aO})});aL(document).find(".dropdown-open").removeClass("dropdown-open");O=null}function j(){var aP=aL(".dropdown:visible").eq(0),aM=aP.data("dropdown-trigger"),aN=aM?parseInt(aM.attr("data-horizontal-offset")||0,10):null,aO=aM?parseInt(aM.attr("data-vertical-offset")||0,10):null;if(aP.length===0||!aM){return}aP.css({left:aP.hasClass("dropdown-anchor-right")?aM.offset().left-(aP.outerWidth()-aM.outerWidth())+aN:aM.offset().left+aN,top:aM.offset().top+aM.outerHeight()+aO})}aL(document).on("click.dropdown","[data-dropdown]",aJ);aL(document).on("click.dropdown",aK);aL(window).on("resize",j)}au(jQuery);function w(aL,j,aJ,aK,aM){this.target=aL;if($.isFunction(j[0])){this.$unfn=j[0];this.$refn=j[1];this.arg=j[2]||null}else{this.$fn=$.fn[j[0]];this.arg=j.slice(1);this.arg.push(null);this.oldval=$.isArray(aJ)?aJ:[aJ];this.newval=aK}this.callback=aM}w.prototype.undo=function(){var j=this;this.target.each(function(aJ){if(j.$unfn){j.$unfn.call(j)}else{j.$fn.apply($(this),j.arg._last(j.oldval[aJ]||""))}});this.callback&&this.callback(this);return this};w.prototype.redo=function(){var aJ=this,j=$.isArray(this.newval);this.target.each(function(aK){if(aJ.$refn){aJ.$refn.call(aJ)}else{aJ.$fn.apply($(this),aJ.arg._last((j?aJ.newval[aK]:aJ.newval)))}});this.callback&&this.callback(this);return this};function aB(j){this.callback=j;this.edits=[]}aB.prototype.undo=function(){for(var j=this.edits.length-1;j>=0;j--){this.edits[j].undo()}return this};aB.prototype.redo=function(){for(var j=0;j<this.edits.length;j++){this.edits[j].redo()}return this};function aE(j,aJ){this.listener=aJ;this.undos=[];this.redos=[]}aE.prototype.clear=function(){this.undos=[];this.redos=[]};aE.prototype.fire=function(j){j&&j.callback&&j.callback.call(j,j.target)};aE.prototype.undo=function(){var j=null;this.undos.length&&this.redos.push(j=this.undos.pop().undo())&&this.fire(j)};aE.prototype.redo=function(){var j=null;this.redos.length&&this.undos.push(j=this.redos.pop().redo())&&this.fire(j)};aE.prototype.add=function(j){if(this.group){this.group.edits.push(j)}else{this.undos.push(j);this.redos=[];this.fire()}};aE.prototype.open=function(){this.group=new aB()};aE.prototype.close=function(){var j=this.group;this.group=null;this.add(j)};var aq=new aE();$s=function(){return $(".ui-selected")};var U=$.fn.attr;$.fn.extend({select:function(){av.firstSelected;if(!$s().length){av.data("first-selected")&&av.data("first-selected").removeClass("ui-selected-first");av.data("first-selected",$(this).addClass("ui-selected-first"))}return $(this).addClass("ui-selected")},unselect:function(){return $(this).removeClass("ui-selected").removeClass("ui-selected-first")},selected:function(){return $(this[0]).hasClass("ui-selected")},vals:function(aL,aJ){var aK=$.fn[aL[0]],j=aL.slice(1);return this.each(function(){aJ.push(aK.apply($(this),j))})},attr2:function(aL,aK){var aJ=U.apply(this,arguments);if(aK!=undefined||aL!="_codestyle"||aJ){return aJ}else{var j=this.parent().html().match(/\b_codestyle\s*=\s*(['"])(.*?)\1/);return j?j[2]:""}},cssFrom:function(aK,aJ){var j=this;$.each(aJ,function(){j.css(this,$(aK).css(this))});return this},_css:function(aJ,aL){var aK=[],j=["css",aJ];this.vals(j,aK).css(aJ,aL);aq.add(new w(this,j,aK,aL));return this},_object:function(){return this.find("object,embed").first()},borderStyle:function(aL){var j={},aK=this,aJ=($(this).attr("style")||"").split(";");if(typeof(aL)=="undefined"){$.each(aJ,function(){var aM=this.split(":");if(aM.length==2&&$.trim(aM[0]).match(/^border.*$/)){j[$.trim(aM[0])]=$.trim(aM[1])}});return j}else{$.each(aJ,function(){var aM=this.split(":");if(aM.length==2&&$.trim(aM[0]).match(/^border.*$/)){$(aK).css($.trim(aM[0]),"")}});return this.css(aL)}},_outerHTML:function(){return jQuery("<p>").append(this.eq(0).clone()).html()},_border:function(){var aJ={},aK="",j=true,aL=this[0];$.each(["Top","Right","Bottom","Left"],function(aM,aO){var aN=$.css(aL,"border"+aO+"Style")+" "+$.css(aL,"border"+aO+"Color")+" "+$.css(aL,"border"+aO+"Width");aJ["border-"+aO.toLowerCase()]=aN.match(/^none.*/)?"":aN;if(aM){if(aK!=aN){j=false}}aK=aN});return j?{border:aJ["border-top"]}:aJ},_codeData:function(aJ){var aK=this.is("object");if(aJ==undefined){var j={};if(aK){this.find("param").each(function(){j[$(this).attr("name")]=$(this).attr("value")})}else{j._codestyle=this.attr("_codestyle");j._code=this.attr("_code")}return j}else{if(aK){this.find("param").each(function(){$(this).attr("value",aJ[$(this).attr("name")])})}else{this.attr(aJ)}try{this[0].setData(aJ._code,aJ._codestyle)}catch(aL){}return this}},_style:function(j){return $.style(this[0],j)},_copyClass:function(aJ,j){if($(aJ).is("."+j)){this.addClass(j)}else{this.removeClass(j)}return this},_copyCss:function(aK,aJ){if(!$.isArray(aJ)){aJ=[aJ]}var j=this;$.each(aJ,function(aL,aM){j.css(aM,$(aK).css(aM))});return this},_copyAttr:function(aL,aK,aJ){if(!$.isArray(aK)){aK=[aK]}var j=this;$.each(aK,function(aM,aN){if(aJ){j.attr(aN,$(aL).attr(aN)||aJ)}else{j.attr(aN,$(aL).attr(aN))}});return this},_appendTo:function(j){if(!j){this.remove()}else{c($(this).appendTo(av).select())}return this},_removeFrom:function(j){if(!j){c($(this).appendTo(av).select())}else{this.remove()}return this},_uClass:function(aL){if(typeof(aL)=="undefined"){var aJ=/\bjp\-comp\-[0-9]+/;var aK=$(this).attr("class");var j=aK.match(aJ);return j?j[0]:""}else{this.addClass(aL);return this}}});Array.prototype._last=function(j){this[this.length-1]=j;return this};function X(j,aJ,aK,aL){$(j).keydown(function(aM){if(aM.keyCode==13){aM.preventDefault();aL($(j).val())}}).blur(function(){aL($(j).val())});$(aJ).click(function(){var aM=Q().chooseFile(aK,"",false);if(aM){$(j).val("file:///"+aM.replace(/(\\)/g,"/"));aL($(j).val())}})}function h(j,aK,aL,aJ,aM){$(j).keydown(function(aN){if(aN.keyCode==13){aN.preventDefault();aM($(j).val())}}).blur(function(){aM($(j).val())});$(aK).click(function(){var aN=Q().chooseFile(aL,"",false);if(aN){var aO=Q().readBase64(aN);$.post(aJ,{name:aN,data:aO},function(aP){$(j).val(aP.replace(/\n/g,""));aM($(j).val())})}})}function am(){var j=this;this.setPaper=function(){if(j.$paperWidth.val()&&j.$paperHeight.val()){var aL=!this.$orientation.is(".jp-landscape-icon"),aJ=this.$paperWidth.val()+"mm",aK=this.$paperHeight.val()+"mm";if(aL){av.css({width:aJ,height:aK}).removeClass("jp-landscape")}else{av.addClass("jp-landscape").css({width:aK,height:aJ})}}L&&L.reposition()};this.getDialog=function(){if(!this.$dialog){this.$dialog=$("#jp-new-dialog");if(editorSettings.type==2||document.URL.match(/^http:\/\//i)){this.$dialog.addClass("jp-with-remote")}this.$dialog.dialog({autoOpen:false,width:510,buttons:{"确定":function(){var aP=j.oldData;aq.open();var aN=aP.src,aO=j.$background.attr("src"),aM=["attr","src"];aq.add(new w(j.$background,aM,aN,aO));aM=["css"];aq.add(new w(j.$background,aM,{filter:aP.filter,opacity:aP.opacity},{filter:j.$background.css("filter"),opacity:j.$background.css("opacity")}));aq.add(new w(av,aM,{width:aP.portrait?aP.width:aP.height,height:aP.portrait?aP.height:aP.width},{width:av._style("width"),height:av._style("height")}));if(aP.portrait&&av.is(".jp-landscape")){aq.add(new w(av,[function(){av.removeClass("jp-landscape")},function(){av.addClass("jp-landscape")}]))}else{if(!aP.portrait&&!av.is(".jp-landscape")){aq.add(new w(av,[function(){av.addClass("jp-landscape")},function(){av.removeClass("jp-landscape")}]))}}aq.add(new w(av,aM,{width:aP.width,height:aP.height},{width:av._style("width"),height:av._style("height")}));aq.close();$(this).dialog("close")},"取消":function(){var aM=j.oldData;j.$background.attr("src",aM.src).css({filter:aM.filter,opacity:aM.opacity});av.css({width:aM.portrait?aM.width:aM.height,height:aM.portrait?aM.height:aM.width});if(aM.portrait){av.removeClass("jp-landscape")}else{av.addClass("jp-landscape")}$(this).dialog("close")}}}),this.$background=$(".jp-paper-background",av),this.$paperWidth=$("#jp-paper-width",this.$dialog),this.$paperHeight=$("#jp-paper-height",this.$dialog),this.$alpha=$("#jp-alpha",this.$dialog),this.$src=$("#jp-image-src",this.$dialog);this.$paperSelect=$("#jp-paper-name",this.$dialog).change(function(){var aM=$(this).val().split(",");if(aM.length>1){j.$paperWidth.val(aM[0]);j.$paperHeight.val(aM[1]);j.setPaper()}else{j.$paperWidth.focus(function(){var aN=this;setTimeout(function(){aN.select()},10)}).focus()}}),setAlpha=function(){var aN=j.$alpha.slider("value");if(aN>0){var aM=(100-aN)/100;j.$background.css({filter:"alpha(opacity="+(100-aN)+")",opacity:aM})}else{j.$background.css({filter:"",opacity:""})}};this.$fileInput=$("#jp-file-input",this.$dialog);this.$paperWidth.add(this.$paperHeight).keydown(function(aM){if(aM.keyCode==13){j.setPaper()}}).blur(function(){j.setPaper()});this.$alpha.slider({orientation:"horizontal",range:"min",max:100,value:0,slide:setAlpha,change:setAlpha});$(".jp-orientation input",this.$dialog).change(function(){if($(this).val()=="-"){j.$orientation.addClass("jp-landscape-icon");if(!av.is(".jp-landscape")){av.css({width:av._style("height"),height:av._style("width")}).addClass("jp-landscape")}}else{j.$orientation.removeClass("jp-landscape-icon");if(av.is(".jp-landscape")){av.css({width:av._style("height"),height:av._style("width")}).removeClass("jp-landscape")}}L&&L.reposition()});this.$orientation=$(".jp-orientation",this.$dialog);var aJ=$("#jp-image-src",this.$dialog);var aJ=$("#jp-image-src",this.$dialog);var aK=$("#jp-file-chooser",this.$dialog);var aL="图片文件(*.png;*.jpg;*.gif)|*.png;*.jpg;*.gif|所有文件 (*.*)|*.*";if(editorSettings.backgroundUploadService){new h(aJ,aK,aL,editorSettings.backgroundUploadService,function(aM){if(aM&&!aM.match(/^http:\/\//i)){aM="../"+aM}j.$background.attr("src",aM||an)})}else{new X(aJ,aK,aL,function(aM){j.$background.attr("src",aM||an)})}}return this.$dialog};this.updateUI=function(){var aN=!av.is(".jp-landscape"),aJ=$.style(av[0],"width"),aK=$.style(av[0],"height");this.oldData={portrait:aN,width:aN?aJ:aK,height:aN?aK:aJ,src:this.$background.attr("src"),filter:this.$background.css("filter")||"",opacity:this.$background.css("opacity")||""};var aM=parseInt(this.oldData.width)+","+parseInt(this.oldData.height);if(!$("option[value='"+aM+"']",this.$paperSelect).length){$('<option value="'+aM+'">'+this.oldData.width+"X"+this.oldData.height+"</option>").insertBefore($("option",this.$paperSelect).last())}this.$paperSelect.val(aM);this.$paperWidth.val(parseInt(this.oldData.width));this.$paperHeight.val(parseInt(this.oldData.height));var aL=null;if(aN){this.$orientation.removeClass("jp-landscape-icon");aL="#jp-paper-portrait"}else{this.$orientation.addClass("jp-landscape-icon");aL="#jp-paper-landscape"}$(aL,this.$dialog)[0].checked=true;this.$src.val(this.oldData.src==an?"":this.oldData.src);this.$alpha.slider("value",100*(1-(this.oldData.opacity||0)))};this.open=function(){var aJ=this.getDialog();this.updateUI();aJ.dialog("open")}}var ap={settings:{},_offset:{top:0,left:0},applySettings:function(j){this.settings={};this._offset.top=0;this._offset.left=0;this.styles=null;if(j){if(j.printer){this.settings.printer=j.printer}if(j.paperWidth){this.settings.settings={paperWidth:j.paperWidth,paperHeight:j.paperHeight,orientation:j.orientation||1}}this.styles=j.styles||""}this.parseOffset()},parseOffset:function(){this._offset.top=0;this._offset.left=0;if(this.styles){var aO=/\.jp\-page\s*\{(.*?)\}/g;var aK=/\bmargin\-(top|left)\s*\:\s*([0-9\.]+)mm/g;var aM=null,j=null;while(aM=aO.exec(this.styles)){var aL=aM[1];while(j=aK.exec(aL)){var aN=j[1];var aJ=j[2];this._offset[aN]=parseFloat(aJ)}return}}},getOffsetStyle:function(){if(this._offset.left||this._offset.top){return".jatools-printing .jp-page{margin-left:{0}mm;margin-top:{1}mm}".format(this._offset.left,this._offset.top)}else{return""}},getDragCSS:function(){var j=b.sourceCodeViewer.util.getChangableStyles(".jp-page ");j.push(this.getOffsetStyle());return j.join("\n")},testPrintOut:function(){var aJ={settings:$.extend({},this.settings)};aJ.styles=this.getDragCSS();var j=editorSettings.getURL();if(j){aJ.documents=j}P(aJ)}};function q(){var j=this;this.getDialog=function(){if(!this.$dialog){this.$dialog=$("#jp-v-offset-dialog").dialog({autoOpen:false,height:540,width:664,buttons:{"打印看看":function(){ap.testPrintOut()},"确定":function(){$(this).dialog("close")},"取消":function(){ap._offset.top=j.oldval;$(this).dialog("close")}}}),this.$dialog.find("#jp-paper-offset").spinner({step:0.1,min:0,numberFormat:"n",change:function(){var aJ=$("#jp-paper-up",j.$dialog)[0].checked;if(aJ){ap._offset.top+=$(this).val()}else{ap._offset.top-=$(this).val()}}}).change(function(){var aJ=$("#jp-paper-up",j.$dialog)[0].checked;if(aJ){ap._offset.top+=$(this).val()}else{ap._offset.top-=$(this).val()}});this.$dialog.find("input:radio").change(function(aK){var aJ=$("#jp-paper-up",j.$dialog)[0].checked;if(aJ){j.$dialog.addClass("jp-upper-off")}else{j.$dialog.removeClass("jp-upper-off")}})}return this.$dialog};this.updateUI=function(){};this.open=function(){var aJ=this.getDialog();this.updateUI();this.oldval=ap._offset.top;aJ.dialog("open")}}function g(){var j=this;this.getDialog=function(){if(!this.$dialog){this.$dialog=$("#jp-h-offset-dialog").dialog({autoOpen:false,height:400,width:546,buttons:{"打印看看":function(){ap.testPrintOut()},"确定":function(){$(this).dialog("close")},"取消":function(){ap._offset.left=j.oldval;$(this).dialog("close")}}}),this.$dialog.find("#jp-paper-offset").spinner({step:0.1,min:0,numberFormat:"n"}).change(function(){var aJ=$("#jp-paper-right",j.$dialog)[0].checked;if(aJ){ap._offset.left-=$(this).val()}else{ap._offset.left+=$(this).val()}});this.$dialog.find("input:radio").change(function(aK){var aJ=$("#jp-paper-right",j.$dialog)[0].checked;if(aJ){j.$dialog.addClass("jp-right-off")}else{j.$dialog.removeClass("jp-right-off")}})}return this.$dialog};this.updateUI=function(){};this.open=function(){var aJ=this.getDialog();this.updateUI();this.oldval=ap._offset.left;aJ.dialog("open")}}function az(){var j=this;this.editor=$("<input class='jp-inplace-editor' type='text'></input>");this.mousedown=function(aJ){if(j.editor[0]!=aJ.target){j.close()}};this.keydown=function(aJ){if(aJ.keyCode==13){j.close()}};this.close=function(){var aK=$(this.target).find(".jp-text-content");var aM=$(this.editor).val();if(this.isText&&!aM.match(/^[\s]*$/)){aM="${"+aM+"}"}var aJ=aK.text();aK.text(aM);var aL=aK.text();if(aL!=aJ){aq.add(new w(aK,["text"],aJ,aL))}$(this.target).removeClass("jp-inplace-editing");$(document).unbind("mousedown",this.mousedown);this.editor.unbind("keydown",this.keydown).remove();this.target=null};this.open=function(aJ){this.target=aJ;this.isText=$(aJ).is(".jp-text");$(aJ).addClass("jp-inplace-editing");var aL=$(".jp-text-content",aJ).text();var aK=aL.match(/^\$\{([^}]*)[}]$/);if(aK){aL=aK[1]}this.editor.appendTo(aJ).css({"font-size":$(aJ).css("font-size"),"font-family":$(aJ).css("font-family"),"text-align":$(aJ).css("text-align")}).val(aL).focus();$(document).bind("mousedown",this.mousedown);this.editor.bind("keydown",this.keydown);return null}}function aI(){var j=this;this.dialogCache={};this.bar_1d=["code39","code93","2of5","code128","code128a","code128b","code128c","ean13"];this.defaults={"bar-1d":{type:"none",rotate:"0",background:null,"bar-color":"#000","space-color":null,"show-text":"true","text-color":"#000","font-size":"11","font-name":"Arial",autofit:"false"},pdf417:{type:"none","err-level":"","data-rows":"","data-cols":"",background:null,"bar-color":"#000","space-color":null},qr:{type:"none",version:"",background:null,"bar-color":"#000","space-color":null},datamatrix:{type:"none","mod-height":"","mod-width":"",background:null,"bar-color":"#000","space-color":null}};this.getGroup=function(aJ){return $.inArray(aJ,this.bar_1d)>-1?"bar-1d":aJ},this.close=function(){},this.parseData=function(aN){var aM=$(aN).data("jp-barcode-data");if(!aM){var aM={};var aL=$(aN)._object()._codeData()._codestyle.split(";");for(var aJ=0;aJ<aL.length;aJ++){var aK=aL[aJ].split(":");aM[aK[0]]=aK[1]}aM=$.extend({},this.defaults[this.getGroup(aM.type)],aM);$(aN).data("jp-code-data",aM)}return aM},this.apply=function(aN,aL){var aK=[],aM=this.defaults[this.getGroup(aL.type)];for(p in aL){var aJ=aL[p];if(aJ!=aM[p]&&aJ){aK.push(p+":"+aJ)}}var aO=$(aN)._object()._codeData();aO._codestyle=aK.join(";");$(aN)._object()._codeData(aO)},this.updateUI=function(aJ){if(!this.updating){this.updating=true;this.$dialog.find(".jp-code-ui").each(function(){var aM=$(this).attr("name");if($(this).is(".jp-color-chooser")){$(this).spectrum("set",aJ[aM]||"rgba(255, 255, 255,0)")}else{if($(this).is(":radio")&&(this.id==="jp-"+$(this).attr("name")+"-"+aJ[aM])){this.checked=true}else{if($(this).is(":checkbox")){this.checked=aJ[aM]===$(this).val()}else{if(this.id=="jp-qr-version"||this.id=="jp-qr-version-2"){$(this).val("");var aL=$(this).is("#jp-qr-version")?0:1;if(aJ.version){var aK=aJ.version.split("-")[aL].toLowerCase();$(this).val(aK=="auto"?"":aK)}}else{if(aM=="moudles"){if(aJ["mod-height"]){$(this).val(aJ["mod-height"]+"x"+aJ["mod-width"])}else{$(this).val("")}}else{if($(this).is("select")&&aJ[aM]){$(this).val(aJ[aM])}}}}}}});this.updating=false}},this.updateData=function(){var aJ=$.extend({},this.$target.data("jp-code-data"));this.$dialog.find(".jp-code-ui").each(function(){var aL=$(this).attr("name");if($(this).is(".jp-color-chooser")){aJ[aL]=$(this).val()=="transparent"?null:$(this).val()}else{if($(this).is(":radio")&&this.checked){aJ[aL]=$(this).val()}else{if($(this).is(":checkbox")){aJ[aL]=this.checked+""}else{if($(this).is("select.qr-version")){var aM=($("#jp-qr-version",this.$dialog).val()||"auto")+"-"+($("#jp-qr-version-2",this.$dialog).val()||"auto");if(aM=="auto-auto"){aM=""}aJ.version=aM}else{if(aL=="moudles"){var aK=$(this).val().split("x");aJ["mod-height"]=aK.length?aK[0]:"";aJ["mod-width"]=aK.length?aK[1]:""}else{if($(this).is("select")){aJ[aL]=$(this).val()}}}}}}});this.$target.data("jp-code-data",aJ);return aJ},this.getDialog=function(aJ){var aM=this.getGroup(aJ),aL=this;if(!this.dialogCache[aM]){var aK=$("#jp-"+aM+"-dialog");k($(".jp-color-chooser",aK));ah($("#jp-font-name",this.$dialog));$(".jp-code-ui",aK).change(function(aN){if(!aL.updating){aL.apply(aL.$target,aL.updateData())}});$("#jp-show-text",aK).change(function(){$(this).closest("p").nextAll().css("display",this.checked?"block":"none")});this.dialogCache[aM]=aK}return this.dialogCache[aM]},this.open=function(aL){var aJ=this;this.$target=$(aL);this.$dialog&&this.$dialog.dialog("close");this.oldval=$.extend({},$(aL)._object()._codeData());var aK=this.parseData(aL);this.$dialog=this.getDialog(aK.type);this.updateUI(aK);if($("#jp-show-text",this.$dialog).length){$("#jp-show-text",this.$dialog).closest("p").nextAll().css("display",$("#jp-show-text",this.$dialog)[0].checked?"block":"none")}this.$dialog.dialog({width:420,buttons:{"确定":function(){var aN=aJ.$target._object()._codeData();var aM=["_codeData"];aq.add(new w(aJ.$target._object(),aM,aJ.oldval,aN));$(this).dialog("close")},"取消":function(){aJ.$target._object()._codeData(aJ.oldval);$(this).dialog("close")}}});return this.$dialog}}function N(){var j=this;this.close=function(){},this.open=function(aN){this.$target=$(aN);if(!this.$dialog){this.$dialog=$("#jp-image-dialog").dialog({width:510,autoOpen:false,buttons:{"确定":function(){var aR=$(".jp-image-view",j.$target);aq.open();aq.add(new w(aR,["attr","src"],j.lastVal.src,aR.attr("src")));var aS=aR.is(".jp-auto-stretch");if(aS!==j.lastVal.stretched){if(aS){aq.add(new w(aR,[function(){this.target.removeClass("jp-auto-stretch")},function(){this.target.addClass("jp-auto-stretch")}]))}else{aq.add(new w(aR,[function(){this.target.addClass("jp-auto-stretch")},function(){this.target.removeClass("jp-auto-stretch")}]))}}aq.close();$(this).dialog("close")},"取消":function(){if(j.lastVal.stretched){$(".jp-image-view",j.$target).addClass("jp-auto-stretch")}else{$(".jp-image-view",j.$target).removeClass("jp-auto-stretch")}$(".jp-image-view",j.$target).attr("src",j.lastVal.src);$(this).dialog("close")}}});var aQ=function(){$(".jp-image-view",j.$target).attr("src",aJ.val()||an);if(aP[0].checked){$(".jp-image-view",j.$target).removeClass("jp-auto-stretch")}else{$(".jp-image-view",j.$target).addClass("jp-auto-stretch")}};var aJ=$("#jp-image-src",this.$dialog);var aK=$("#jp-file-chooser",this.$dialog);var aM="图片文件 (*.png;*.jpg;*.gif)|*.png;*.jpg;*.gif|所有文件 (*.*)|*.*";new X(aJ,aK,aM,aQ);var aP=$("#jp-original-size",this.$dialog).change(aQ)}var aO=$(".jp-image-view",this.$target).attr("src")||"";$("#jp-image-src",this.$dialog).val(aO==an?"":aO);var aL=$(".jp-image-view",this.$target).is(".jp-auto-stretch");$("#jp-original-size",this.$dialog)[0].checked=!aL;this.lastVal={src:aO,stretched:aL};return this.$dialog.dialog("open")}}function ag(){var j=this;this.open=function(aK,aJ){this.callok=aJ;if(!this.$dialog){this.$dialog=$("#jp-template-save-dialog").dialog({width:400,autoOpen:false,buttons:{"确定":function(){if(j.callok){if(j.callok($(this).find("#jp-settings-id").val())){$(this).dialog("close")}}else{$(this).dialog("close")}},"取消":function(){$(this).dialog("close")}}})}this.$dialog.find("#jp-settings-id").val(aK||"");return this.$dialog.dialog("open")}}function ax(aJ){var j=$(aJ).data("code-data");if(!j){j=$(aJ).data()}}function l(aJ){var j=b.newBarcode.replace(/\$\{(.*?)\}/g,function(aL,aK){return aJ[aK]});return $(j)}function aA(){this.decode=function(aJ,aM){var aL=this;$(".jp-component",av).remove();aq.clear();var j=aJ._style("width"),aK=aJ._style("height");j&&av.css("width",j);aK&&av.css("height",aK);av._copyClass(aJ,"jp-landscape").removeClass("jp-hidden");av.find(".jp-paper-background").attr("src",an);aJ.children().each(function(aP){for(e in aL.decoders){if($(this).is(e)){var aO=aL.decoders[e].call(aL,$(this),aP,aM);if(aO){c(aO.appendTo(av)._copyCss($(this),["left","top","width","height"])._uClass($(this)._uClass()),true);var aN=$(this)._border();if(aN&&aN.border!=""){$(aO).css(aN)}}return}}});L&&L.reposition()},this.decoders={".jp-paper-background":function(j,aL,aJ){var aK=j.attr("src");if(aK){if(aJ){aK=Q().getAbsoluteURL(aK,aJ)}}else{aK=an}$(".jp-paper-background",av).attr("src",aK)._copyCss(j,["filter","opacity"])},".jp-label":function(aJ,aK){var j=$(b.newLabel);$(".jp-text-content",j).text(aJ.text());return j._copyCss(aJ,["font-family","font-weight","font-style","text-decoration","font-size","color","background-color","text-align","z-index"])},".jp-text":function(j,aK){var aJ=$(b.newText);$(".jp-text-content",aJ).text(j.text());return aJ._copyCss(j,["font-family","font-weight","font-style","text-decoration","font-size","color","background-color","text-align","z-index"])},".jp-barcode":function(j,aK){var aJ=l(j._object()._codeData());return aJ._copyCss(j,["background-color","z-index"])},".jp-image":function(j,aO,aM){var aN=j.attr("src");if(aN){if(aM){aN=Q().getAbsoluteURL(aN,aM)}}else{aN=an}var aL=$(b.newImage),aK=j.find("img"),aJ=aL.find("img").attr("src",aN)._copyClass(aK,"jp-auto-stretch");return aL._copyCss(j,["background-color","z-index"])}},this.encoders={".jp-paper-background":function(j,aK){if(j.attr("src")==an){return null}else{var aJ=j.attr("src");return{style:j.attr("style"),comp:$('<img class="jp-paper-background screen-only">').attr("src",aJ)}}},".jp-label":function(j,aK){var aJ=$(".jp-text-content",j).text();return{style:j.attr("style"),comp:$('<div class="jp-label jp-comp-'+aK+'">').text(aJ)}},".jp-text":function(j,aK){var aJ=$(".jp-text-content",j).text();return{style:j.attr("style"),comp:$('<div class="jp-text jp-comp-'+aK+'">').text(aJ)}},".jp-barcode":function(j,aN,aM){var aJ='<object classid="CLSID:E5A01FF5-FC6E-42F3-AF48-DEA5777DED62" ><param name="_code" value="${_code}"/><param name="_codestyle" value="${_codestyle}"/><embed type="application/x-vnd.jatoolsCoder" _code="${_code}" _codestyle="${_codestyle}"></embed></object>';var aL=j._object()._codeData();var aJ=aJ.replace(/\$\{(.*?)\}/g,function(aP,aO){return aL[aO]});var aK=$(aJ);aK.find("embed")._codeData(j._object()._codeData());if(!aM){aK.find("embed").remove()}return{style:j.attr("style"),comp:$('<div class="jp-barcode jp-comp-'+aN+'">').append(aK)}},".jp-image":function(aJ,aL){var j=$("img",aJ);var aK=$(j[0].cloneNode());if(aK.attr("src")==an){aK.attr("src","")}return{style:aJ.attr("style"),comp:$('<div class="jp-image jp-comp-'+aL+'">').append(aK)}}},this.headObject=function(){return'<OBJECT ID="jatoolsPrinter" CLASSID="CLSID:B43D3361-D075-4BE2-87FE-057188254255" codebase="jatoolsPrinter.cab#version=5,7,0,0"></OBJECT>'};this.bodyObject=function(){return['<object id="ojatoolsPrinter" codebase="jatoolsPrinter.cab#version=5,4,0,0"','	classid="clsid:B43D3361-D075-4BE2-87FE-057188254255" width="0" height="0">','	<embed id="ejatoolsPrinter" type="application/x-vnd.jatoolsPrinter" width="0" height="0"></embed>',"</object>"].join("\n")};this.debugButtons=function(j){return["<div>",'<input type="button" value="打印预览..." onClick="doPrint(\'打印预览...\')">','<input type="button" value="打印..." onClick="doPrint(\'打印...\')">','<input type="button" value="打印" onClick="doPrint(\'打印\')">','<span style="font-size:12px;color:gray;margin-left:20px;">'+(j?"本网页代码可以在IE,Firefox,Chrome,Safari 上打印.":"本网页代码只可以在IE上打印噢.")+"</span>","</div>"].join("\n")},this.debugScript=function(j){var aJ=o();return["<script>","function doPrint(how){","	var myDoc={","		settings:{","			paperWidth:"+aJ.settings.paperWidth+",","			paperHeight:"+aJ.settings.paperHeight+",","			orientation:"+aJ.settings.orientation,"		},","		marginIgnored:true,","		enableScreenOnlyClass:true,","		documents:document,","		copyrights:'杰创软件拥有版权  www.jatools.com'","	};",j?"	var jatoolsPrinter = navigator.userAgent.indexOf('MSIE') > -1 ? document.getElementById('ojatoolsPrinter'): document.getElementById('ejatoolsPrinter');":"","	if(how=='打印预览...')","		jatoolsPrinter.printPreview(myDoc);","	else if(how=='打印...')","		jatoolsPrinter.print(myDoc,true);","	else","		jatoolsPrinter.print(myDoc,false);","}","<\/script>"].join("\n")};this.getChangableStyles=function(aK){var j=[],aJ=this;av.children().each(function(){for(e in aJ.encoders){if($(this).is(e)){var aM=aJ.encoders[e].call(aJ,$(this),0,true);if(aM){if(aM.style){var aL=$(this)._uClass();if(aL){j.push(aK+"."+aL+"{"+aM.style+"}")}}}}}});return j},this.applyUClass=function(){var aJ=[];var j=[];av.children().each(function(){var aK=$(this)._uClass();if(aK){aJ[aK]=true}else{j.push($(this))}});$.each(j,function(aM,aL){for(var aM=0;true;aM++){var aK="jp-comp-"+aM;if(!aJ[aK]){$(this)._uClass(aK);aJ[aK]=1;break}}})};this.encodeTemplate=function(){var aL=this;var aK=$('<div id="page${pageNo}" class="jp-page">').css({width:av._style("width"),height:av._style("height")})._copyClass(av,"jp-landscape");var j=0;var aJ=[];this.applyUClass();av.children().each(function(){for(e in aL.encoders){if($(this).is(e)){var aO=aL.encoders[e].call(aL,$(this),j,true);if(aO){var aM=$(this)._uClass();var aN=aO.comp._uClass();if(aN){aO.comp.removeClass(aN).addClass(aM)}aK.append(aO.comp);if(aO.style){aJ.push("."+aM+"{"+aO.style+"}")}j++}}}});return{styles:[".jp-page{position:relative}",".jp-text,.jp-label,.jp-image,.jp-barcode{position:absolute;overflow:hidden}",".jp-auto-stretch,.jp-barcode object,.jp-barcode embed{width: 100%; height: 100%;}",".jp-paper-background{position:absolute;width:100%;height:100%;}",B(aJ.join("\n"))].join("\n"),pageBody:aK._outerHTML().replace(/\<param\s*[^>]*\>/g,"")}};this.encode=function(aJ,j){var aN=this;var aM=$('<div id="page1" class="jp-page">').css({width:av._style("width"),height:av._style("height")})._copyClass(av,"jp-landscape");var aK=0;var aL=[];av.children().each(function(){for(e in aN.encoders){if($(this).is(e)){var aO=aN.encoders[e].call(aN,$(this),aK,j);if(aO){aM.append(aO.comp);if(aO.style){aL.push(".jp-comp-"+aK+"{"+aO.style+"}")}aK++}}}});return["<html>","<head>","<title>jatoolsPrinter打印</title>",'<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">',((!j)&&aJ)?this.headObject():"","<style>",".jp-page{position:relative}",".jp-text,.jp-label,.jp-image,.jp-barcode{position:absolute;overflow:hidden}",".jp-auto-stretch,.jp-barcode object,.jp-barcode embed{width: 100%; height: 100%;}",".jp-paper-background{position:absolute;width:100%;height:100%;}",B(aL.join("\n")),"</style>",aJ?this.debugScript(j):"","</head>","<body>",aJ?this.debugButtons(j):"",aM.appendTo(document.body)._outerHTML(),(j&&aJ)?this.bodyObject():"","</body>","</html>"].join("\n")}}function S(){var j=this;this.util=new aA();this.close=function(){},this.setCode=function(aK,aL){var aJ=new SyntaxHighlighter.HtmlScript("js");aJ.init({toolbar:false,brush:"htmlscript"});Y(this.util.encode(aK,aL),function(aM){$("#jp-plain-code",j.$dialog).val(aM);aM=aJ.getHtml(aM.replace(/</g,"&lt;").replace(/>/g,"&gt;"));aM=aM.replace(/([$][{][^}]*[}])/gm,"<span class='jp-expression'>$1</span>");$("#jp-code",j.$dialog).html(aM);j.$dialog.dialog("open").find(".syntaxhighlighter").scrollLeft(0)})};this.open=function(){if(!this.$dialog){$("#jp-source-code-dialog").find(".jp-button-set").buttonset();this.$dialog=$("#jp-source-code-dialog").dialog({width:610,autoOpen:false});$("#jp-copy-code",this.$dialog).click(function(){E($("#jp-plain-code",j.$dialog).val())});$("#jp-save-code",this.$dialog).click(function(){aF($("#jp-plain-code",j.$dialog).val())});$("input:checkbox",this.$dialog).change(function(){var aL=$("#jp-debug-code",j.$dialog)[0].checked;var aM=$("#jp-cross-browser",j.$dialog)[0].checked;j.setCode(aL,aM)})}var aJ=$("#jp-debug-code",this.$dialog)[0].checked;var aK=$("#jp-cross-browser",this.$dialog)[0].checked;this.setCode(aJ,aK);return this.$dialog}}function aC(){var j=this;this.reposition=function(){var aK=Math.min($(window).width()-220,$(".jp-page").width()+15);var aJ=this.$dialog.dialog("option","position",[aK,45]).dialog("option","height");if(this.$dialog.height()>$(window).height()){this.$dialog.dialog("option","height",$(window).height())}};this.create=function(aL,aN){var aM=aL.expr||"${"+aL.text+"}";var aJ="new"+aL.type.charAt(0).toUpperCase()+aL.type.slice(1);var aK=null;if(aL.type=="barcode"){aK=l({_code:aM,_codestyle:"type:"+aL.codetype+";autofit:true"}).attr("title",aM);aK.css({width:100,height:100})}else{aK=$(b[aJ])}$s().unselect();c(aK.appendTo(av).offset(aN).select());if(aL.type=="label"){if(aL.text=="+"){H.edit(aK)}else{aK.find(".jp-text-content").text(aL.expr||aL.text)}}else{if(aL.type=="text"){aK.find(".jp-text-content").text(aM)}else{if(aL.type=="image"){aK.find("img").attr("src",aM);aK.css({width:100,height:100})}}}aq.add(new w(aK,["_appendTo"],null,av))};this.open=function(){this.$dialog=$("#jp-comp-list-dialog");this.$panel=this.$dialog.find("#jp-comp-list");$.each(editorSettings.fields,function(aL,aM){j.$panel.append($('<li><a href="#">'+(aM.text||"")+"</a></li>").data("jp-field-data",aM))});$("li",this.$dialog).draggable({appendTo:av,helper:"clone"});var aK=Math.min($(window).width()-220,$(".jp-page").width()+15);this.$dialog.dialog({top:50,position:[aK,45],width:210,autoOpen:true});var aJ=this.$dialog.dialog("option","height");if(this.$dialog.height()>$(window).height()){this.$dialog.dialog("option","height",$(window).height())}$(window).resize(function(){j.reposition()});av.droppable({accept:"#jp-comp-list li",drop:function(aL,aM){var aN=$(this).find("li.ui-draggable-dragging").offset();j.create(aM.draggable.data("jp-field-data"),aN)}});return this}}var av=$(".jp-page");var ay=new az();var G=new aI();function y(j){if(aw&&$(j.target).closest(".jp-page").add($(j.target).closest("a.jp-creating")).length==0){d()}}function o(){var aN={settings:{},marginIgnored:true,enableScreenOnlyClass:true,logPage:true,copyrights:"杰创软件拥有版权  www.jatools.com"};var aL=aN.settings;var aO=!av.is(".jp-landscape"),j=$.style(av[0],"width"),aK=$.style(av[0],"height"),aJ=aO?j:aK,aM=aO?aK:j;aL.paperWidth=parseInt(aJ)*10;aL.paperHeight=parseInt(aM)*10;aL.orientation=aO?1:2;return aN}function aG(j){aw&&d();j.closest("a").add($(document.body)).addClass("jp-creating");$(document).one("mousedown",y);$(".ui-draggable",av).each(function(){$(this).data("draggable").options.disabled=true})}function d(){aw=null;$(".ui-draggable",av).each(function(){$(this).data("draggable").options.disabled=false});$(".jp-creating").removeClass("jp-creating");$(document).unbind("mousedown",y)}function aa(aL,aK){var j=["borderStyle"],aJ=[];aL.vals(j,aJ).borderStyle(aK);aq.add(new w(aL,j,aJ,aK));return aL}function aj(){var j=$("#jp-ax");var aJ=j.contents()[0];aJ.open();aJ.writeln(["<html>","   <body>",'      <object id="ojatoolsPrinter" codebase="jatoolsPrinter.cab#version=5,4,0,0"','         classid="clsid:B43D3361-D075-4BE2-87FE-057188254255" width="0" height="0">','         <embed id="ejatoolsPrinter" type="application/x-vnd.jatoolsPrinter" width="0" height="0" />',"      </object>","   </body>","</html>"].join("\n"));aJ.close()}function P(j){var aL=o();if(!j||!j.documents){var aJ=$("#jp-for-print",document.body);if(!aJ.length){aJ=$('<iframe id="jp-for-print" class="jp-html-loader"><iframe>')}$(document.body).append(aJ);var aK=aJ.contents()[0];aK.open();aK.writeln(b.sourceCodeViewer.util.encode(false,!$.browser.msie));aK.close();aL.documents=aK}if(j){$.extend(true,aL,j)}Q().printPreview(aL)}var b={"copied-flag":"jp-component-copied:","copied-flag-test":/^jp\-component\-copied\:/,paperEditor:new am(),sourceCodeViewer:new S(),newLabel:"<div class='jp-label jp-component'><span class='jp-text-content'></span><p class='jp-selected-layer'></p></div>",newText:"<div class='jp-text jp-component'><span class='jp-text-content'></span><p class='jp-selected-layer'></p></div>",newBarcode:'<div class="jp-barcode jp-component" ><p class="jp-selected-layer"></p>'+(($.browser.msie)?('<OBJECT windowless="true" classid=CLSID:E5A01FF5-FC6E-42F3-AF48-DEA5777DED62 ><param name="_code" value="${_code}"></param><param name="_codestyle" value="${_codestyle}"></param></OBJECT>'):('<embed _code="${_code}" _codestyle="${_codestyle}" type="application/x-vnd.jatoolsCoder"  windowless="true"></embed>'))+"</div>",newImage:"<div class='jp-image jp-component'><img class='jp-image-view' src='"+an+"'></img><p class='jp-selected-layer'></p></div>","jp-new":function(){this.paperEditor.open()},"jp-v-offset":function(){if(!this.paperVerticalOffsetDialog){this.paperVerticalOffsetDialog=new q()}this.paperVerticalOffsetDialog.open()},"jp-h-offset":function(){if(!this.paperHorizonOffsetDialog){this.paperHorizonOffsetDialog=new g()}this.paperHorizonOffsetDialog.open()},"jp-open":function(){s()},"jp-save":function(){this.sourceCodeViewer.open()},"jp-print":function(){if(editorSettings.getURL()){if(editorSettings.type==2){var j=b.sourceCodeViewer.util.encodeTemplate();j.settingsID=editorSettings.settingsID+".tmp";j.how="upload";$.post(editorSettings.templateService,j,function(aJ){ap.testPrintOut()})}else{ap.testPrintOut()}}else{P()}},"jp-undo":function(){aq.undo()},"jp-redo":function(){aq.redo()},"jp-delete":function(j){aq.add(new w($s(),["_removeFrom"],null,av));$s().remove()},"jp-copy":function(aJ){var j=$s().clone();j.find(".ui-resizable-handle").remove();E(this["copied-flag"]+$("<div>").append(j)._outerHTML())},"jp-cut":function(j){aq.add(new w($s(),["_removeFrom"],null,av));this["jp-copy"].call(this);$s().remove()},"jp-paste":function(aK){var aJ=v()||"";if(aJ.match(this["copied-flag-test"])){$s().unselect();var j=$(aJ.substring(this["copied-flag"].length)).children().each(function(aL,aO){if($(this).is(".jp-barcode")){var aM=$(this)._object();if(($.browser.msie&&aM.is("embed"))||((!$.browser.msie)&&aM.is("object"))){var aN=l(aM._codeData())._object();$(this).append(aN);aM.remove()}}$(this).removeClass("ui-selected jp-ininted ui-draggable ui-resizable")});j=c(j.appendTo(av).animate({left:"+=5",top:"+=5"},0).select());aq.add(new w(j,["_appendTo"],null,av))}},"jp-font":function(j){$s()._css("font-family",$(j.target).val())},"jp-bold":function(aJ){var j=$(aJ.target)[0].checked?"700":"normal";$s()._css("font-weight",j)},"jp-italic":function(j){var aJ=$(j.target)[0].checked?"italic":"normal";$s()._css("font-style",aJ)},"jp-color":function(j){},"jp-background":function(j){},"jp-underline":function(aJ){var j=$(aJ.target)[0].checked?"underline":"none";$s()._css("text-decoration",j)},"jp-align-left":function(j){$s()._css("text-align",$(j.target).val())},"jp-align-center":function(j){$s()._css("text-align",$(j.target).val())},"jp-align-right":function(j){$s()._css("text-align",$(j.target).val())},"jp-new-label":function(j){aG($(j.target));aw=$(this.newLabel)},"jp-new-text":function(j){aG($(j.target));aw=$(this.newText)},"jp-new-barcode":function(aJ){var j=$(aJ.target).attr("code-type");aG($(aJ.target));aw=l({_code:j=="2of5"?"1234567":"6938012345670",_codestyle:"type:"+j+";autofit:true"})},"jp-new-image":function(j){aG($(j.target));aw=$(this.newImage)},"jp-font-size":function(aM){var aK=[],aL=[],j=["css","font-size"];var aJ=aM?-2:2;$s().vals(j,aK).each(function(){var aN=(parseInt($(this).css("font-size"))+aJ)+"px";$(this).css({"font-size":aN})}).vals(j,aL);aq.add(new w($s(),j,aK,aL))},"jp-size-up":function(j){this["jp-font-size"].call(this,false)},"jp-size-down":function(j){this["jp-font-size"].call(this,true)},"jp-front":function(aL){if($s().length==1){var aK=$s()[0],j=[],aJ={};$(".jp-component",av).each(function(aN){var aM=$(this).css("z-index");j.push(aM);aJ[aM]=this}).each(function(){if(aK==this){j.sort();var aO=$(this).css("z-index");var aN=$.inArray(aO,j);if(aN<j.length-1){var aP=j[aN+1];var aM=aJ[aP];aq.open();$(aK)._css("z-index",aP);$(aM)._css("z-index",aO);aq.close()}}})}},"jp-back":function(aL){if($s().length==1){var aK=$s()[0],j=[],aJ={};$(".jp-component",av).each(function(aN){var aM=$(this).css("z-index");j.push(aM);aJ[aM]=this}).each(function(){if(aK==this){j.sort();var aO=$(this).css("z-index");var aN=$.inArray(aO,j);if(aN>0){var aP=j[aN-1];var aM=aJ[aP];aq.open();$(aK)._css("z-index",aP);$(aM)._css("z-index",aO);aq.close()}}})}},"jp-top":function(aL){if($s().length==1){var aK=$s()[0],j=[],aJ={};$(".jp-component",av).vals(["css","z-index"],j);$(aK)._css("z-index",Math.max.apply(null,j)+1)}},"jp-bottom":function(aL){if($s().length==1){var aK=$s()[0],j=[],aJ={};$(".jp-component",av).vals(["css","z-index"],j);$(aK)._css("z-index",Math.min.apply(null,j)-1)}},"jp-align2-left":function(j){if($s().length>1){$s()._css("left",av.data("first-selected").css("left"))}},"jp-align2-center":function(aJ){if($s().length>1){var aK=av.data("first-selected");var j=parseInt(aK.css("left"))+parseInt(aK.css("width"))/2;aq.open();$s().each(function(){var aM=parseInt($(this).css("left"))+parseInt($(this).css("width"))/2;var aL=parseInt($(this).css("left"))+(j-aM);$(this)._css("left",aL)});aq.close()}},"jp-align2-right":function(aJ){if($s().length>1){var aK=av.data("first-selected");var j=parseInt(aK.css("left"))+parseInt(aK.css("width"));aq.open();$s().each(function(){var aL=parseInt($(this).css("left"))+parseInt($(this).css("width"));var aM=parseInt($(this).css("left"))+(j-aL);$(this)._css("left",aM)});aq.close()}},"jp-align2-top":function(j){if($s().length>1){$s()._css("top",av.data("first-selected").css("top"))}},"jp-align2-middle":function(aJ){if($s().length>1){var aK=av.data("first-selected");var j=parseInt(aK.css("top"))+parseInt(aK.css("height"))/2;aq.open();$s().each(function(){var aM=parseInt($(this).css("top"))+parseInt($(this).css("height"))/2;var aL=parseInt($(this).css("top"))+(j-aM);$(this)._css("top",aL)});aq.close()}},"jp-align2-bottom":function(aJ){if($s().length>1){var aK=av.data("first-selected");var j=parseInt(aK.css("top"))+parseInt(aK.css("height"));aq.open();$s().each(function(){var aL=parseInt($(this).css("top"))+parseInt($(this).css("height"));var aM=parseInt($(this).css("top"))+(j-aL);$(this)._css("top",aM)});aq.close()}},"jp-equal-width":function(j){if($s().length>1){$s()._css("width",av.data("first-selected").css("width"))}},"jp-equal-height":function(j){if($s().length>1){$s()._css("height",av.data("first-selected").css("height"))}},"jp-move-left":function(j){if($s().length){aq.open();$s().each(function(){var aJ=parseInt($(this).css("left"))-1;$(this)._css("left",aJ)});aq.close()}},"jp-move-up":function(j){if($s().length){aq.open();$s().each(function(){var aJ=parseInt($(this).css("top"))-1;$(this)._css("top",aJ)});aq.close()}},"jp-move-right":function(j){if($s().length){aq.open();$s().each(function(){var aJ=parseInt($(this).css("left"))+1;$(this)._css("left",aJ)});aq.close()}},"jp-move-down":function(j){if($s().length){aq.open();$s().each(function(){var aJ=parseInt($(this).css("top"))+1;$(this)._css("top",aJ)});aq.close()}},"jp-border-1px":function(j){aa($s(),{border:"solid 1px black"})},"jp-border-no":function(j){aa($s(),{border:""})},"jp-border-custom":function(aO){var aK=$("#jp-border-dialog"),j=$s();if(!aK.is(".ui-dialog-content")){aK.find(".jp-button-set").buttonset();var aJ=$("#jp-border-viewer",aK),aR=$("#jp-line-viewer",aK),aM={"jp-border-none":function(){aJ.css("border","")},"jp-border-all":function(){aJ.css("border",aR._border()["border-top"])},"jp-border-left":function(){aJ.css("border-left",aR._border()["border-top"])},"jp-border-top":function(){aJ.css("border-top",aR._border()["border-top"])},"jp-border-right":function(){aJ.css("border-right",aR._border()["border-top"])},"jp-border-bottom":function(){aJ.css("border-bottom",aR._border()["border-top"])},"jp-border-style-1px":function(){aR.css("border-top-width","1px")},"jp-border-style-2px":function(){aR.css("border-top-width","2px")},"jp-border-style-3px":function(){aR.css("border-top-width","3px")},"jp-border-style-4px":function(){aR.css("border-top-width","4px")},"jp-border-style-5px":function(){aR.css("border-top-width","5px")},"jp-border-style-6px":function(){aR.css("border-top-width","6px")},"jp-border-style-solid":function(){aR.css("border-top-style","solid")},"jp-border-style-dashed":function(){aR.css("border-top-style","dashed")},"jp-border-style-dotted":function(){aR.css("border-top-style","dotted")}};aK.dialog({autoOpen:false,width:425,height:390,buttons:{"确定":function(){var aS=aJ._border();if($s().length){aa($s(),aS)}$(this).dialog("close")},"取消":function(){$(this).dialog("close")}}});$(".jp-border-previewer",aK).click(function(aS){$.each([".border-top",".border-right",".border-bottom",".border-left"],function(aT,aV){if($(aS.target).is(aV)){var aU=aV.substring(1);old=$.style(aJ[0],aU)||$.style(aJ[0],"border");aJ.css(aU,old?"":$.style(aR[0],"border-top"))}})});$(".jp-border-command a").click(function(aS){var aT=$(this)[0].id;aM[aT]&&aM[aT]()});k($("#jp-border-color",aK),null,function(aS){aR.css("border-top-color",aS.toHexString())})}var aL=$("#jp-line-viewer",aK),aP=$("#jp-temp",aK).borderStyle($s().first().borderStyle())._border(),aN=null;for(p in aP){if(!aP[p].match(/^none.*/)){aN=aP[p];break}}aL.css("border-top",aN||"solid 1px black");var aQ=$("#jp-border-viewer",aK).borderStyle($s().first().borderStyle());$("#jp-border-viewer",aK).borderStyle($s().first().borderStyle());aK.dialog("open")}};function ah(aL){try{var aM=ab().getFonts();if(aM){var aJ=$(aL)[0];for(var j=0;j<aM.length;j++){aJ.options[j]=new Option(aM[j],aM[j])}}}catch(aK){}}var C={"ctrl+c":{cmd:"jp-copy",enabled:5},"ctrl+x":{cmd:"jp-cut",enabled:5},"ctrl+v":{cmd:"jp-paste",enabled:5},"ctrl+z":{cmd:"jp-undo",enabled:7},"ctrl+y":{cmd:"jp-redo",enabled:7},"ctrl+]":{cmd:"jp-size-up",enabled:7},"ctrl+[":{cmd:"jp-size-down",enabled:7},"ctrl+PgUp":{cmd:"jp-front",enabled:7},"ctrl+PgDn":{cmd:"jp-back",enabled:7},"ctrl+End":{cmd:"jp-bottom",enabled:7},"ctrl+Home":{cmd:"jp-top",enabled:7},"46":{cmd:"jp-delete",enabled:5},"37":{cmd:"jp-move-left",enabled:5},"38":{cmd:"jp-move-up",enabled:5},"39":{cmd:"jp-move-right",enabled:5},"40":{cmd:"jp-move-down",enabled:5},forView:function(j){for(e in this){if(this[e].enabled){this[e].enabled&=j}}}};var K={"33":"PgUp","34":"PgDn","35":"End","36":"Home","219":"[","221":"]"};$(document).keydown(function(aJ){if(!$(aJ.target).is("input")){var j=null;if(aJ.ctrlKey){j="ctrl+"+(K[aJ.keyCode+""]||String.fromCharCode(aJ.keyCode).toLowerCase())}else{if(aJ.keyCode==46||aJ.keyCode<=40&&aJ.keyCode>=37){j=aJ.keyCode+""}}if(j&&C[j]&&C[j].enabled){j=C[j].cmd;b[j]&&b[j].call(b);aJ.preventDefault();return false}}});var al=null;function k(aJ,j,aK){$(aJ).each(function(aN){var aM=this;var aL={showInitial:true,showPalette:true,showSelectionPalette:true,maxPaletteSize:10,preferredFormat:"hex",cancelText:"取消",chooseText:"确定",localStorageKey:"spectrum.demo",palette:[["rgba(255, 255, 255,0)","rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(255, 255, 255)"].slice($(this).is(".jp-with-transparent")?0:1),["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"]],change:function(aO,aP){aK&&aK(aO,aP)},show:function(){al=aM},hide:function(){al=null}};j&&(aL=$.extend(j,aL));$(this).spectrum(aL)})}var ad=function(j,aJ){$s()._css(aJ.style,j.alpha?j.toHexString():"transparent")};function ao(j){return("0"+parseInt(j).toString(16)).slice(-2)}function B(j){return j.replace(/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(aK,aM,aL,aJ){return"#"+ao(aM)+ao(aL)+ao(aJ)})}k($("#jp-color"),{style:"color"},ad);k($("#jp-background"),{style:"background-color"},ad);$.ui.plugin.add("resizable","rulerSet",{resize:function(j,aP){var aO=$(aP.helper),aM=aO.data("resizable"),aN=aM.size;var aL=aO.data("oldVals");aN.width+=aL.dx;aN.height+=aL.dy;var aJ=aO.data("connectors").slice(0);aJ[1]=aJ[0]+Math.round(aN.width/2);aJ[2]=aJ[0]+aN.width;aJ[4]=aJ[3]+Math.round(aN.height/2);aJ[5]=aJ[3]+aN.height;siblingConnectors=aO.data("sibling-connectors");var aK=function(aS,aT,aR,aU){var aV=(aU-aR)==2?1:2;aM.size[aR?"height":"width"]=(aT-aS[aR])*aV-(aR?aL.dy:aL.dx)};var aQ=W(aJ,siblingConnectors,[2,1],[5,4],aK);aO.data("rulers",aQ)}});var aH=function(aL){var aK=$(aL).offset(),j=$(aL).outerWidth(),aJ=$(aL).outerHeight();return[aK.left,aK.left+Math.round(j/2),aK.left+j,aK.top,aK.top+Math.round(aJ/2),aK.top+aJ,j,aJ,$(aL)]};var af=function(aJ){var j=[];$(".ui-draggable",av).each(function(){var aM=$(this).offset();var aL=$(this).data("connectors");if(true||!aL){aL=aH(this);$(this).data("connectors",aL)}var aK=$(this).data("connector");if(!aK){aK=$('<p class="jp-connector jp-ruler-element"></p>').appendTo($(aJ).parent());$(this).data("connector",aK);$(this).data("connector2",$('<p class="jp-connector jp-ruler-element"></p>').appendTo($(aJ).parent()))}aK.offset({left:aL[1]-3,top:aL[4]-3});if(this!=aJ){j.push(aL)}else{$(aJ).data("sibling-connectors",j)}})};var z=function(aK,aJ){var j=aH(aK);$.each(aJ,function(aO){var aM=j[this.from[1]];var aP=j[this.from[2]];$(aK).data(aO?"connector2":"connector").css("display","block").offset({left:aM-3,top:aP-3});var aQ=this.to[0].data("connectors");var aL=aQ[this.to[1]];var aN=aQ[this.to[2]];this.to[0].data("connector").css("display","block").offset({left:aL-3,top:aN-3});if(this.name=="h"){$(".jp-h-ruler").css({width:Math.abs(aM-aL),display:"block"}).offset({left:Math.min(aM,aL),top:aN})}else{$(".jp-v-ruler").css({height:Math.abs(aP-aN),display:"block"}).offset({left:aL,top:Math.min(aP,aN)})}})};var r=function(aP,aN,aT,aS,aJ){var aL=Number.MAX_VALUE,aW=[];var aK=(aT==1)?aJ+1:aJ;var j=(aS==1)?aJ+1:aJ;var aR=(aT==1)?aK+1:aJ+3;var aQ=(aS==1)?j+1:aJ+3;for(var aO=aK;aO<aR;aO++){var aV=aP[aO];for(var aM=j;aM<aQ;aM++){var aU=aN[aM];if(Math.abs(aU-aV)<aL){aW[0]=aO;aW[1]=aM;aL=Math.abs(aU-aV)}}}return aW};var W=function(j,aM,aL,aK,aP){$(".jp-ruler-element").css("display","none");var aJ=false;var aO=false;var aN=[];$.each(aM,function(){var aQ=this;$.each(aK,function(aR,aT){var aS=j[aT],aU=aT;$.each([4,5,3],function(aW,aY){var aV=aQ[aY];if(aV-2<=aS&&aS<=aV+2){aP(j,aV,3,aU);var a0=r(j,aQ,aU-3,aY-3,0);var aZ=a0[0],aX=a0[1];aN.push({name:"h",from:[j[8],aZ,aU],to:[aQ[8],aX,aY]});aO=true;return !aO}});return !aO});$.each(aL,function(aS,aT){var aR=j[aT],aU=aT;$.each([1,2,0],function(aW,aX){var aV=aQ[aX];if(aV-2<=aR&&aR<=aV+2){aP(j,aV,0,aU);var a0=r(j,aQ,aU,aX,3);var aZ=a0[0],aY=a0[1];aN.push({name:"v",from:[j[8],aU,aZ],to:[aQ[8],aX,aY]});aJ=true;return !aJ}});return !aJ});return !(aO&&aJ)});return aN};$.widget("ui.mydraggable",$.ui.draggable,{_create:function(){this.element.data($.ui.draggable.prototype.widgetName,this.element.data($.ui.mydraggable.prototype.widgetName));$.ui.draggable.prototype._create.call(this)},_generatePosition:function(aL){aL.target=$(aL.target).closest(".jp-component")[0];var aS=$.ui.draggable.prototype._generatePosition.call(this,aL),aM=$(aL.target);var aN=this;if($(aL.target).data("dragging")){var aJ=function(aU,aV,aT,aX){var aW=aT?"top":"left";aS[aW]=aV+aU[aT]-aU[aX]-aN.offset.parent[aW]};var j=aM.data("connectors").slice(0),aP=aM.data("sibling-connectors"),aR=aL.pageX-this.lastPageX,aQ=aL.pageY-this.lastPageY;for(var aK=0;aK<6;aK++){j[aK]+=((aK<3)?aR:aQ)}var aO=W(j,aP,[1,2,0],[4,5,3],aJ);$(aL.target).data("rulers",aO)}return aS},_mouseStart:function(aK){this.lastPageX=aK.pageX;this.lastPageY=aK.pageY;aK.target=$(aK.target).closest(".jp-component")[0];var aL=$(aK.target).position(),j=[aL.left,aL.top];$s().not(aK.target).each(function(){var aM=$(this).position();(aM.left<j[0])&&(j[0]=aM.left);(aM.top<j[1])&&(j[1]=aM.top)});var aJ=$(aK.target).parent().offset();j[0]=aJ.left+aL.left-j[0];j[1]=aJ.top+aL.top-j[1];j[2]=j[3]=1000000;this.options.containment=j;af(aK.target);$.ui.draggable.prototype._mouseStart.call(this,aK)}});var ar=1000;var aw=null;$(".jp-common-command a,.jp-common-command input").click(function(aJ){var j=b[$(this).attr("id")];j&&j.call(b,aJ)});var R=null;$(".jp-commands >a").button().click(function(){if($(this).is("#jp-reset-all")){Q().clearLastSettings(editorSettings.settingsID);D(editorSettings.getURL())}else{if($(this).is("#jp-reset-position")){Q().setDragCSS(editorSettings.settingsID,"");D(editorSettings.getURL())}else{if($(this).is(".jp-ok")){Q().setDragCSS(editorSettings.settingsID,ap.getDragCSS());window.close()}else{if($(this).is(".jp-upload-template")){var j=b.sourceCodeViewer.util.encodeTemplate();var aJ=(editorSettings.settingsID||"__")=="__"?"":editorSettings.settingsID;if(!R){R=new ag()}R.open(aJ,function(aK){if((aK||"").match(/^\s*$/)){return false}else{editorSettings.settingsID=aK;j.settingsID=editorSettings.settingsID;j.how="upload";$.post(editorSettings.templateService,j,function(aL){});return true}})}else{if(editorSettings.callback){editorSettings.callback()}window.close()}}}}});$(".jp-new-barcode").button({icons:{primary:"jp-primary-icon",secondary:"ui-icon-triangle-1-s"},text:false});$(".jp-layers").button({icons:{primary:"jp-primary-icon",secondary:"ui-icon-triangle-1-s"},text:false});$(".jp-align2").button({icons:{primary:"jp-primary-icon",secondary:"ui-icon-triangle-1-s"},text:false});$(".jp-border").button({icons:{primary:"jp-primary-icon",secondary:"ui-icon-triangle-1-s"},text:false});$(".jp-border-style").button({icons:{primary:"jp-primary-icon",secondary:"ui-icon-triangle-1-s"},text:false});$(".jp-border-width").button({icons:{primary:"jp-primary-icon",secondary:"ui-icon-triangle-1-s"},text:false});$("#jp-barcode-chooser a").click(function(j){b["jp-new-barcode"].call(b,j)});var m=[".jp-view001,.jp-view011,.jp-view010",".jp-view100,.jp-view101,.jp-view001",".jp-view100,.jp-view110,.jp-view010"];C.forView(1<<editorSettings.type);$(".jp-main-tools .jp-button-set").each(function(){$(m[editorSettings.type],this).remove();$(this).css("display","block");if(!$(this).is(".jp-commands")){$(this).buttonset()}});function u(j){var aK=[100],aJ=$(".jp-component",av);if(j){aJ=aJ.not(j)}aJ.vals(["css","z-index"],aK);return Math.max.apply(null,aK)+1}function n(){var j=av.find(".ui-selecting");if(j.length==1){av.data("first-selected")&&av.data("first-selected").removeClass("ui-selected-first");av.data("first-selected",$(j[0]).addClass("ui-selected-first"))}}var V=false;$(".jp-page").selectable({distance:1,filter:".jp-component",start:function(aJ){f();var j=$(aJ.target).data("selectable-item",null).data("selectable");j.helper.css("z-index",u());if(aw){var aK=j.options.filter;j.options.filter="#jp-undefined";j.selectees=$("#jp-undefined",aJ.target);$(aJ.target).data("_filter",aK)}},stop:function(aL){if(aw){var aK=$(aL.target).data("selectable").helper;var aM=aK.offset();var j=aK.width();if(j<10){j=150}var aJ=aK.height();if(aJ<10){aJ=30}$s().unselect();c(aw.appendTo(av).offset(aM).width(j).height(aJ).select());aq.add(new w(aw,["_appendTo"],null,av));H.edit(aw);$(aL.target).data("selectable").options.filter=$(aL.target).data("_filter");d();V=true}aL.stopPropagation();return false},selecting:function(j,aJ){n()},unselecting:function(j,aJ){n()}}).find(".jp-paper-background").click(function(j){if($(j.target).is(".jp-paper-background")&&!V){$s().unselect()}V=false}).dblclick(function(j){if(!$(j.target).closest(".jp-component").length){b["jp-new"].call(b)}});var H={edit:function(j){for(e in this.editors){if(j.is(e)){this.editors[e].open(j)}}},editors:{".jp-text":ay,".jp-label":ay,".jp-barcode":G,".jp-image":new N()}};aj();var L=null;$(window).resize(function(){var j=$(this).innerHeight()-$(".jp-toolbar").height()-4;$(".jp-content").outerHeight(j)});$(window).resize();setTimeout(function(){ah($("#jp-font-chooser").change(b["jp-font"]));if(editorSettings.type==1){D(editorSettings.getURL())}else{if(editorSettings.type==2){if(!editorSettings.settingsID){editorSettings.settingsID="__";L=new aC().open();b["jp-new"].call(b)}else{L=new aC().open();D(editorSettings.templateService+"&how=download&settingsID="+encodeURI(editorSettings.settingsID))}}}},1000);if(!editorSettings.willLoad()){av.removeClass("jp-hidden")}function c(aK,aJ){var j=$(aK).each(function(){var aL=this;if(!$(aL).is(".jp-ininted")){$(aL).addClass("jp-ininted").mydraggable({start:function(aO,aP){selected=$s().each(function(){var aQ=$(this);aQ.data("offset",aQ.offset())});if(!$(this).selected()){$(this).select()}offset=$(this).offset();var aN=[],aM=["offset"];selected.vals(aM,aN);$(aO.target).data({oldOffsets:aN,dragging:selected.length==1})},stop:function(aO){$(aO.target).data({dragging:false,rulers:null});$(".jp-ruler-element").css("display","none");var aN=[],aM=["offset"];$s().vals(aM,aN);aq.add(new w($s(),aM,$(aO.target).data("oldOffsets"),aN))},drag:function(aO,aQ){var aN=aQ.position.top-offset.top,aM=aQ.position.left-offset.left;selected.not(this).each(function(){var aR=$(this),aS=aR.data("offset");aR.css({top:aS.top+aN,left:aS.left+aM})});var aP=$(aO.target).data("rulers");if(aP){z(aO.target,aP)}}}).resizable({rulerSet:true,start:function(aN,aM){af(aN.target);var aO={width:$(aN.target).width(),height:$(aN.target).height()};aO.dx=$(aN.target).outerWidth()-aO.width;aO.dy=$(aN.target).outerHeight()-aO.height;$(aN.target).data({oldVals:aO,dragging:true})},resize:function(aO,aN){var aM=$(aO.target).data("rulers");if(aM){z(aO.target,aM)}},stop:function(aO){var aQ=$(aO.target);$(".jp-ruler-element").css("display","none");var aM=aQ.width(),aN=aQ.height();var aP=aQ.data("oldVals");aq.open();aq.add(new w(aQ,["width"],aP.width,aM));aq.add(new w(aQ,["height"],aP.height,aN));aq.close();aQ.data({dragging:false,rulers:null,oldVals:null})}}).mousedown(function(aM){if(!$(this).selected()){if(!aM.ctrlKey){$(this).siblings().unselect()}$(this).select()}}).dblclick(function(aM){H.edit($(this))})}});if(!aJ){j.css("z-index",u(j))}return j}});